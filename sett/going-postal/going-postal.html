<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <style type="text/css">
      body {
        color: rgb(0, 0, 0);
        background-color: rgb(255, 255, 255);
        font-family: Verdana, sans-serif;
        margin-left: 0.25in;
        margin-right: 0.25in;
      }
      a.career {
        font-weight: bold;
      }
      a:hover {
        color: rgb(0, 0, 255);
        background-color: rgb(255, 253, 160);
      }
      code {
        font-family: "Courier New", monospace;
      }
      div.center {
        text-align: center;
      }
      h1 {
        text-align: center;
      }
      h2 {
        text-align: left;
      }
      h3 {
        text-align: left;
      }
      h4 {
        text-align: left;
      }
      h5 {
        text-align: left;
      }
      hr {
        height: 1px;
        color: rgb(17, 59, 86);
        background-color: transparent;
      }
      kbd {
        font-family: "Courier New", monospace;
      }
      p {
        text-align: justify;
      }
      p.author {
        text-align: center;
      }
      p.footer {
        text-align: justify;
      }
      pre {
        font-family: "Courier New", monospace;
      }
      .educationquicklinks {
        text-align: center;
      }
      .quicklinks {
        text-align: right;
      }
      .red {
        color: rgb(255, 0, 0);
        background-color: rgb(255, 255, 255);
      }
      .green {
        color: rgb(0, 128, 0);
        background-color: rgb(255, 255, 255);
      }
      .blue {
        color: rgb(0, 0, 192);
        background-color: rgb(255, 255, 255);
      }
      .code {
        background-color: #FFFFF0;
        border: dashed black 1px;
        padding-left: 10px;
      }
      .comment {
        color: rgb(128,128,128);
        font-weight: normal;
        font-style: italic;
      }
      .table_header {
        background: pink;
      }
      .table_name {
        font-weight: bold;
        vertical-align: top;
      }
      .table_desc {
        font-weight: normal;
        vertical-align: top;
      }
    </style>
  </head>
  <body>

    <h1>Going Postal with postal.js</h1>
    <p class="author">
      by<br />
      Nicholas Cloud, Software Engineer<br />
      Object Computing, Inc. (OCI)
    </p>

    <h2>Do as I say, not as I do</h2>

    <p>
      There are two important ideas that are common to applications developed on all platforms, in all languages, and in all paradigms.
    </p>

    <p>
      The first idea is that code should, to some extent, be isolated from other code.  In classical languages encapsulation is accomplished by access modifiers on classes and members; in functional languages this is accomplished with closures; and in procedural languages this is accomplished by the religious inclusion of underscores in structure member names, a ritual which reminds other developers to behave themselves and pretend that said members are, in fact, private.
    </p>

    <p>
      The second idea is that these isolated pieces of code, whilst hiding their implementations from prying eyes, nevertheless must communicate with each other, much like those awkward conversations we all have every year at Thanksgiving.  Regardless of how code is organized, if it cannot communicate or message other code, our programs would be severely restricted and code reuse would cease to be posible.
    </p>

    <p>
      On the surface, both of these ideas might appear to be antithetical.  How can hidden or encapsulated code, about which external code must necessarily be agnostic, communicate with the very code it hides from?  In classical languages, messaging occurs through abstract APIs and interfaces, so that dispirate units of code know how to message each other, but only through a gatekeeper.  Private members and data are obfuscated behind a coarse set of public members that control the state of objects.  Objects only talk to each other through these gatekeepers.  In functional languages, the gatekeepers are higher order functions, or functions that are composed of other functions.  These act as "wrappers" to a more complicated set of transformations and again, present a coarse API to which other functions may send "messages".  In these languages, then, the class and the function are the units of code composition respectively, and the units of communication between encapsultated code.  Classes and functions, however, are rarely useful by themselves, and are often organized into class libraries, or function modules, so that they can use other classes and functions to accomplish tasks that exceed their immediate concerns.  Encapsulation and communication ensure that all of these constructs play nicely with their peers.
    </p>

    <h2>JavaScript: the chimera</h2>

    <p>
      One day Brendan Eich forgot to have his morning shot of espresso and, in a decafinated stupor, creatd the JavaScript programming language.  I cannot vouch for the accuracy of this claim but, as this is not a history exposition, we will assume the truth of it.  JavaScript is unique because it is a functional language with classical trappings.  JavaScript code may be organized according to classical conventions primarily through the use of JavaScript constructor functions, or it may be organized according to functional conventions in which individual functions are composed and passed as arguments to other functions.  Regardless of organization style, the same general principles of encapsulation and communication apply to JavaScript code.
    </p>

    <p>
      JavaScript objects can message each other via methods, and JavaScript functions can message each other via invocation.  In the dark and distant past, it was common for constructor functions (classes) and functions to live in the global JavaScript scope, which meant that all classes and functions were accesible everywhere.  This was often mitigated by creating classes and functions as public members of a global, named object literal, so that what was once <code>var bar = function () {...};</code> became <code>var Foo = {}; Foo.bar = function () {...};</code>.  This was a much more pleasant situation, but it did nothing to prevent accidental assignment from happening to members of the named object literal, since it was still in the global scope.
    </p>

    <p>
      A far more elegant solution to this problem has come into favor in modern times: the JavaScript module pattern.  Because JavaScript is a functional language, it can leverage closures to give objects returned from a function access to what would otherwise be "private" data and code within the function.  This object then becomes a public API to the code contained within its closure function.  Instead of organizing classes and functions in the global scope, or making them members of a global object, these constructs can be declared inside of a large function closure and only the parts that should be exposed publically can be returned from the closure function invocation, creating a form of encapsulation.  Other code can "message" code within the closure by invoking members on the returned object (or, if the returned object is a function itself, invoking it directly).
    </p>

    <p>
      The module pattern solves the problem of encapsulation, but what we still have is a failure to communicate.  We want modules to message other modules so we can build composible JavaScript applications.  Since modules are large function closures, it makes sense that the closure might accept, as function arguments, the public objects returned from other module closures.  Messages could be sent to, and received from, other modules by interacting with these objects.  This is, in fact, how many JavaScript programs are structured.  There are even libraries such as <a href="http://requirejs.org/" target="_blank" title="require.js">require.js</a> that will resolve and "inject" module dependencies for the developer.  This approach works well for a manageable set of modules, but what happens when modules, like Tribbles, begin to multiply?  What happens when one operation in a given module affects several, or all other modules in an application?  The list of dependencies begins to grow, and every time a new module is introduced, otherwise working code must be changed.
    </p>

    <p>
      This can be avoided. We have the technology. We can build it.
    </p>

    <h2>Sometimes going postal <em>is</em> the answer</h2>

    

<!-- outline
- introduction
  + two important aspects of code: isolation and communication
  + classical vs. modular approach to code organization
  + a need to communicate between modules, both client and server side

- enter postal.js
  + an in-memory service bus, open source, maintained by Jim Cowart
  + uses messages rather than events
  + different than DOM events
  + different than EventEmitter events

- postal.js on the client
  + module eventing with callbacks
  + module messaging with postal.js
  + throw require.js into the mix (?)
  + use with jQuery (maybe include posta.jquery.js example?)

- postal.js on the server
  + inter-module communication with postal
  + intra-module communication with EventEmitter

-->

<!--
    <h3>Minor Heading</h3>
    <p>Paragraph Content</p>

    <p>A code example that demonstrates <code>foo()</code>:
      <pre><code>
var f = function foo (bar) { 
  return bar.substr(1);
}
      </code></pre>
-->


    <h2>References</h2>
    <ul>
      <li><a href="https://github.com/ifandelse/postal.js" title="postal.js Github repository">postal.js Github repository</a></li>
      <li><a href="http://jsfiddle.net/ifandelse/NTPcT/" title="postal.js jsFiddle examples">postal.js jsFiddle examples</a></li>
      <li><a href="http://www.twitter.com/ifandelse" title="Jim Cowart (@ifandelse) on Twitter">Jim Cowart (@ifandelse) on Twitter</a></li>
      <li><a href="http://freshbrewedcode.com/jimcowart/2011/12/05/client-side-messaging-with-postal-js-part-1/" title="Client-side Messaging in JavaScript – Part 1 (Postal.js)">Client-side Messaging in JavaScript – Part 1 (Postal.js)</a></li>
      <li><a href="http://freshbrewedcode.com/jimcowart/2012/02/02/client-side-messaging-in-javascript-part-2-postal-js/" title="Client-side Messaging in JavaScript – Part 2 (Postal.js)">Client-side Messaging in JavaScript – Part 2 (Postal.js)</a></li>
      <li><a href="http://freshbrewedcode.com/jimcowart/2012/03/19/client-side-messaging-in-javascript-part-3-anti-patterns/" title="Client-side messaging in JavaScript – Part 3 (anti-patterns)">Client-side messaging in JavaScript – Part 3 (anti-patterns)</a></li>
    </ul>

  </body>
</html>